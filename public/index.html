<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Checkout Frames v2</title>
  <style>
    *,
    *::after,
    *::before {
      box-sizing: border-box
    }

    html {
      padding: 1rem;
      background-color: #FFF;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif
    }

    #payment-form {
      width: 31.5rem;
      margin: 0 auto
    }

    iframe {
      width: 100%
    }

    .one-liner {
      display: flex;
      flex-direction: column
    }

    #pay-button {
      border: none;
      border-radius: 3px;
      color: #FFF;
      font-weight: 500;
      height: 40px;
      width: 100%;
      background-color: #13395E;
      box-shadow: 0 1px 3px 0 rgba(19, 57, 94, 0.4)
    }

    #pay-button:active {
      background-color: #0B2A49;
      box-shadow: 0 1px 3px 0 rgba(19, 57, 94, 0.4)
    }

    #pay-button:hover {
      background-color: #15406B;
      box-shadow: 0 2px 5px 0 rgba(19, 57, 94, 0.4)
    }

    #pay-button:disabled {
      background-color: #697887;
      box-shadow: none
    }

    #pay-button:not(:disabled) {
      cursor: pointer
    }

    .card-frame {
      border: solid 1px #13395E;
      border-radius: 3px;
      width: 100%;
      margin-bottom: 8px;
      height: 40px;
      box-shadow: 0 1px 3px 0 rgba(19, 57, 94, 0.2)
    }

    .card-frame.frame--rendered {
      opacity: 1
    }

    .card-frame.frame--rendered.frame--focus {
      border: solid 1px #13395E;
      box-shadow: 0 2px 5px 0 rgba(19, 57, 94, 0.15)
    }

    .card-frame.frame--rendered.frame--invalid {
      border: solid 1px #D96830;
      box-shadow: 0 2px 5px 0 rgba(217, 104, 48, 0.15)
    }

    .success-payment-message {
      color: #13395E;
      line-height: 1.4
    }

    .token {
      color: #b35e14;
      font-size: 0.9rem;
      font-family: monospace
    }

    @media screen and (min-width: 31rem) {
      .one-liner {
        flex-direction: row
      }

      .card-frame {
        width: 318px;
        margin-bottom: 0
      }

      #pay-button {
        width: 175px;
        margin-left: 8px
      }
    }
  </style>
</head>

<body>
  <script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script>

  <!-- Load our React component. -->
  <!-- <script src="response.js" defer></script> -->
  <!-- add frames script -->
  <script src="https://cdn.checkout.com/js/framesv2.min.js"></script>
  <script src="axios.min.js"></script>

  <form id="payment-form" method="POST" action="https://merchant.com/charge-card">
    <div class="one-liner">
      <div class="card-frame">
        <!-- form will be added here -->
      </div>
      <!-- add submit button -->
      <button id="pay-button" disabled>
        PAY GBP 24.99
      </button>
    </div>
    <p class="success-payment-message"></p>
  </form>

  <div id="root"></div>
  <script>
    // const domContainer = document.querySelector('#root');
    // ReactDOM.render(e(LikeButton), domContainer);
    // this an example will be used to send post request to the server with issued card_token created by checkoutjs
    const getUserData = async function getUserData({amount, currency, token, reference, metadata, Authorization }) {
      const { data } = await axios.post("//${serverURL}", {
        "source": {
          "type": "token",
          "token": token
        },
        "amount": amount,
        "currency": currency,
        "reference": reference,
        "metadata": metadata
      }, {
        'Content-Type': 'application/json',
        Authorization: Authorization
      });
      return data;
    }

    const payButton = document.getElementById("pay-button");
    const form = document.getElementById("payment-form");

    // Frames.init("pk_test_35ee23a1-9188-4b9e-b49c-970dac16e778");
    Frames.init("${publicKey}");

    Frames.addEventHandler(
      Frames.Events.CARD_VALIDATION_CHANGED,
      function (event) {
        console.log("CARD_VALIDATION_CHANGED: %o", event);

        payButton.disabled = !Frames.isCardValid();
      }
    );



    Frames.addEventHandler(
      Frames.Events.CARD_TOKENIZED,
      async function (event) {
        const el = document.querySelector(".success-payment-message");
        el.innerHTML = 'Card tokenization completed<br>' +
          'Your card token is: <span class="token">' + event.token + '</span>';

        const userData = await getUserData({
          amount: 2,
          currency: 'EGP',
          token: event.token,
          reference: "ORD-5023-4E89",
          metadata: {
            "udf1": "TEST123",
            "coupon_code": "NY2018",
            "partner_id": 123989
          },
          Authorization: "${secretKey}"});

          el.innerHTML += '<br><br>' + '<div>' + JSON.stringify(userData) + '</div>';
      }

    );
    form.addEventListener("submit", function (event) {
      event.preventDefault();
      Frames.submitCard();
    });
  </script>

</body>

</html>